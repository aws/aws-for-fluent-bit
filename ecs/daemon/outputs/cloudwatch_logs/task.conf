
[FILTER]
    Name              ecs
    Match             app.var.lib.docker.containers.*
    ECS_Tag_Prefix    app.var.lib.docker.containers.
    ADD               container    $ECSContainerName
    ADD               ecs_task_id  $TaskID
    ADD               ecs_family   $TaskDefinitionFamily

[FILTER]
    Name               aws
    Match              app.var.lib.docker.containers.*
    imds_version       v2
    az                 false
    ec2_instance_id    true


# output for tags rewritten by above filter
[OUTPUT]
    Name                   cloudwatch_logs
    Match                  app.*
    # log group/stream names with metadata templating
    log_group_template     /aws/ecs/${CLUSTER_NAME}/application/$ecs_family
    log_stream_template    $ec2_instance_id.$ecs_task_id.$container
    # fallback group: for containers where we couldn't attach metadata
    # this happens when you have containers not part of an ECS task
    log_group_name         /aws/ecs/${CLUSTER_NAME}/application/fallback-group-for-failed-metadata-templating
    # fallback stream
    log_stream_prefix      json-log-driver-file-
    region                 ${REGION_TASK}
    auto_create_group      On
    workers                1
