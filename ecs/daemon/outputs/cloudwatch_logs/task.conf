
[FILTER]
    Name              ecs
    Match             task.var.lib.docker.containers.*
    ECS_Tag_Prefix    task.var.lib.docker.containers.
    ADD               container    $ECSContainerName
    ADD               ecs_task_id  $TaskID
    ADD               ecs_family   $TaskDefinitionFamily

[FILTER]
    Name               aws
    Match              task.var.lib.docker.containers.*
    imds_version       v1
    az                 false
    ec2_instance_id    true


[OUTPUT]
    Name                   cloudwatch_logs
    Match                  task.var.lib.docker.containers.*
    # log group/stream names with metadata templating
    log_group_template     /aws/ecs/${CLUSTER_NAME}/application/$ecs_family
    log_stream_template    $ec2_instance_id.$ecs_task_id.$container
    # fallback group if templating fails
    log_group_name         /aws/ecs/${CLUSTER_NAME}/application/fallback-group-for-failed-metadata-templating
    # fallback stream to log_stream_prefix + tag (log file name) if templating fails
    log_stream_prefix      json-log-driver-file-
    region                 ${REGION_TASK}
    auto_create_group      On
    workers                1