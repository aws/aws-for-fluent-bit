[FILTER]
    Name               aws
    Match              runtime.*
    imds_version       v1
    az                 false
    ec2_instance_id    true


[FILTER]
    Name                  rewrite_tag
    Match                 runtime.*
    Rule                  $ec2_instance_id ^[\S]+$  container-runtime.$ec2_instance_id.$TAG[1] false
    Emitter_Name          re_emitted_task
    Emitter_Storage.type  filesystem
    Emitter_Mem_Buf_Limit 10M


[OUTPUT]
    Name                         s3
    # Match all rewritten tags that have EC2 instance ID, ex: container-runtime.i-0b52d191c2a02063f.docker
    Match                        container-runtime.*
    bucket                       ${BUCKET_RUNTIME}
    region                       ${REGION_RUNTIME}
    upload_timeout               1m
    total_file_size              10M
    s3_key_format                /aws/ecs/${CLUSTER_NAME}/runtime/$TAG[1]/$TAG[2]/%Y/%m/%d/%H/%M/%S
    s3_key_format_tag_delimiters .
    store_dir                    /tmp/fluent-bit/s3-store

[OUTPUT]
    Name                         s3
    # Match all raw tags where we failed to add instance ID and so tag will be: runtime.docker|containerd.service
    Match                        runtime*
    bucket                       ${BUCKET_RUNTIME}
    region                       ${REGION_RUNTIME} 
    upload_timeout               1m
    total_file_size              10M
    s3_key_format                /aws/ecs/${CLUSTER_NAME}/runtime/instance-ID-lookup-failed/$TAG[1]/%Y/%m/%d/%H/%M/%S
    s3_key_format_tag_delimiters .
    store_dir                    /tmp/fluent-bit/s3-store